# 개발 변경 로그

## v0.2.2 (2025-12-29)

### 주요 기능 구현

#### 병원용 요약 차트 고도화 (약/영양제)
- **기능**: 최근 15일 복용 이력 시각화
- **상세**:
  - 연속 복용 (2일 이상) → **막대(Bar)** 표시
  - 비연속/단발 복용 → **점(Dot)** 표시
  - 기존 텍스트 리스트 형태에서 타임라인 그리드 형태로 변경하여 시인성 개선

---
## v0.2.1 (2025-12-29)

### 버그 수정

#### 데이터베이스 초기화 레이스 컨디션 수정
- **현상**: 병원용 요약 차트 등 진입 시 `NullPointerException` (NativeDatabase.prepareAsync) 발생
- **원인**: 앱 실행 초기 `PetProvider`와 화면 컴포넌트가 동시에 DB 접근 시, 테이블 초기화가 완료되기 전에 쿼리를 실행하는 경쟁 상태 발생
- **해결**: `database.ts` 싱글톤 패턴 적용 및 초기화 Promise 대기 로직 강화

---
## v0.2.0 (2025-12-28)

### 주요 기능 구현

#### 약/영양제 소프트 삭제 기능
- **데이터 보존 정책**: 삭제 시에도 과거 복용 기록은 완전히 보존
- **소프트 삭제 구조**:
  - `supplements` 테이블에 `deletedAt` 컬럼 추가
  - 하드 삭제 대신 타임스탬프로 삭제 상태 표시
  - `supplement_records` 테이블의 기록은 모두 유지
- **삭제 UX**:
  - 약/영양제 항목을 길게 누르면 삭제 가능
  - 삭제 확인 다이얼로그에서 "과거 기록 유지됨" 명시
  - 삭제된 항목은 "오늘 복용 체크" 목록에서 제거
- **캘린더/차트 표시**:
  - 삭제된 약/영양제는 연한 회색 배지 "삭제됨" 표시
  - 과거 복용 기록 조회 시 삭제 상태 명확히 표시
  - 데이터 연속성 유지로 차트 추이 그래프 정상 작동

---

## v0.1.0 (2025-12-26)

### 주요 기능 구현

#### SQLite 로컬 데이터베이스
- 모든 테이블 스키마 구현 (pets, daily_records, food_records 등)
- 서비스 레이어 구현:
  - `database.ts` - DB 초기화 및 테이블 생성
  - `dailyRecords.ts` - 일일 컨디션 기록
  - `foodRecords.ts` - 사료 기호성
  - `supplements.ts` - 약/영양제 복용 체크
  - `hospitalRecords.ts` - 병원 방문 기록
  - `fluidRecords.ts` - 수액 기록
  - `customMetrics.ts` - 커스텀 수치

#### 캘린더 화면 (신규)
- 월 단위 캘린더 UI
- 날짜별 기록 인디케이터 (●/🔴/💊/💧)
- 일자 요약 카드 (조회 전용)
- 무료 사용자 15일 제한
- 오늘만 수정 가능 (과거는 읽기 전용)

#### 탭 네비게이션 변경
```
변경 전: [ 홈 🏠 ] [ 기록 📝 ] [ 차트 📊 ] [ 설정 ⚙️ ]
변경 후: [ 오늘 📋 ] [ 캘린더 📅 ] [ 차트 📊 ] [ 설정 ⚙️ ]
```

---

### UI/UX 개선

#### 용어 표준화
| 변경 전 | 변경 후 |
|---------|---------|
| 오줌 | 소변 |
| 똥 | 배변 |
| 설사 | 묽은 변 |
| 구토 | 구토 (유지) |

#### 설정 화면 간소화
- 제거: 데이터 백업, 데이터 복원
- 유지: Pro 업그레이드, 앱 정보, 개인정보 처리방침, 이용약관, 데이터 초기화

---

### 기술 개선

#### React 버전 호환성
- npm overrides로 React 19.1.0 통일
- expo-sqlite 연동 안정화

#### Safe Area 처리
- SafeAreaProvider 적용
- 탭바 하단 inset 대응
- 각 화면 상단 safe area 처리

### 탭별 UX 재설계
- **오늘 탭**: 입력 전용 대시보드로 통합
  - 소변/배변/묽은 변/구토 카운터 (Undo 지원)
  - 수액 기록 (ml 입력, Undo 지원)
  - 약/영양제 체크박스
  - 메모 저장
  - **신규 기능**: 카운트 클릭 시 수치 직접 수정 (Modal), 입력 후 실행 취소(Undo) 토스트
- **캘린더 탭**: 조회 전용 (오늘 포함 수정 불가)
- **설정 탭**: PIN 설정, 백업/복원 추가

### 문서 추가
- `docs/planning/CALENDAR_SPEC.md` - 캘린더 화면 명세
- `docs/planning/TAB_UX_SPEC.md` - 탭별 UX 명세
- `docs/CHANGELOG.md` - 변경 로그

---

## 다음 단계 (예정)
- [ ] 백엔드 API 연동 (백업/복원)
- [ ] 인앱 결제 연동 (Pro)
- [ ] 앱스토어 배포 준비
