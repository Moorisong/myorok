# 개발 변경 로그

## v0.4.0 (2025-12-29)

### 오늘의 위로 탭 추가

- **커뮤니티 기능**:
  - 집사들이 하루 동안 서로 위로와 응원을 나누는 공간
  - 모든 게시글 자정에 자동 삭제 (배너로 안내)
  - 익명 디바이스 기반 식별 (Device-XXXX)

- **게시글 기능**:
  - 글 작성 (500자 제한)
  - 1시간에 1번 작성 제한 (서버 기준)
  - 욕설 필터 `***` 마스킹
  - 좋아요 기능

- **댓글 기능**:
  - 댓글 작성 (300자 제한)
  - 횟수 제한 없음
  - 접기/펼치기 UI

- **신고/차단**:
  - 게시글 신고 (3회 이상 시 자동 숨김)
  - 사용자 차단 (차단된 사용자 글 숨김)

- **UX**:
  - 30초 폴링 자동 갱신
  - 서버 준비 중 안내 화면
  - FAB 글쓰기 버튼

---

## v0.3.0 (2025-12-29)

### 설정 탭 PIN 잠금 기능

- **서버 연동 PIN 구현**:
  - PIN은 서버에서만 해시 저장 (클라이언트 저장 없음)
  - bcrypt 해시 사용
  - 5회 연속 실패 시 5분간 잠금
  
- **API 엔드포인트**:
  - `POST /api/settings/pin` - PIN 설정
  - `POST /api/settings/pin/verify` - PIN 검증
  - `GET /api/settings/pin/status` - PIN 상태 조회
  - `DELETE /api/settings/pin` - PIN 해제

- **클라이언트 기능**:
  - 세션 메모리 기반 잠금 해제 상태 관리
  - 10분 무활동 시 자동 재잠금
  - 앱 백그라운드 전환 시 자동 잠금
  - PIN 입력 모달 (숫자 키패드, 흔들림 애니메이션)

- **설정 화면 UX**:
  - 잠금 상태 배너 표시
  - 잠금 시 민감한 설정 항목 비활성화 (고양이 관리, 데이터 초기화)
  - PIN 관리 화면 (설정/변경/해제)

- **보안 정책**:
  - PIN 또는 해시를 클라이언트에 저장하지 않음
  - 서버 단독 검증
  - 실패 메시지 단순화 (보안)

---

## v0.2.4 (2025-12-29)

### 병원용 요약 차트 UI 정렬 개선
- **고정 레이아웃 그리드 시스템**:
  - 모든 차트(15일/1개월/3개월)가 동일한 컨테이너 폭과 정렬 기준점 공유
  - 기간 전환 시 시각적 기준점이 흔들리지 않음
- **3점 앵커 시스템**:
  - X축 라벨: 시작/중앙/종료 3개 고정 위치
  - 수직 가이드라인 추가 (시각적 기준점 명확화)
- **3개월 차트 개선**:
  - 12주 고정 그리드
  - 날짜 헤더 추가 (12주전/6주전/오늘)
- **차트 순서 변경**:
  - 기존: 배변 → 약/영양제 → 강수/수액
  - 변경: 배변 → 강수/수액 → 약/영양제
- **버그 수정**:
  - 기간 전환 시 이전 데이터가 잠깐 보이는 플래시 현상 수정
  - 테스트 버튼 제거 및 불필요 코드 정리

---

## v0.2.3 (2025-12-29)

### 병원용 요약 차트 Pro 기능
- **기간별 적응형 UI 구현**:
  - **최근 15일/1개월**: 일별 타임라인 (Timeline View)
  - **최근 3개월**: 주 단위 복용 빈도 시각화 (Thick/Thin Bar, Dot)
  - **전체 기간**: 약/영양제별 요약 카드 (총 복용일, 평균 주간 빈도)
- **UX 개선**:
  - Pro 모드 동작 시뮬레이션 (기간 선택 시 안내 및 자동 활성화)

## v0.2.2 (2025-12-29)

### 주요 기능 구현

#### 병원용 요약 차트 고도화 (약/영양제)
- **기능**: 최근 15일 복용 이력 시각화
- **상세**:
  - 연속 복용 (2일 이상) → **막대(Bar)** 표시
  - 비연속/단발 복용 → **점(Dot)** 표시
  - 기존 텍스트 리스트 형태에서 타임라인 그리드 형태로 변경하여 시인성 개선

---
## v0.2.1 (2025-12-29)

### 버그 수정

#### 데이터베이스 초기화 레이스 컨디션 수정
- **현상**: 병원용 요약 차트 등 진입 시 `NullPointerException` (NativeDatabase.prepareAsync) 발생
- **원인**: 앱 실행 초기 `PetProvider`와 화면 컴포넌트가 동시에 DB 접근 시, 테이블 초기화가 완료되기 전에 쿼리를 실행하는 경쟁 상태 발생
- **해결**: `database.ts` 싱글톤 패턴 적용 및 초기화 Promise 대기 로직 강화

---
## v0.2.0 (2025-12-28)

### 주요 기능 구현

#### 약/영양제 소프트 삭제 기능
- **데이터 보존 정책**: 삭제 시에도 과거 복용 기록은 완전히 보존
- **소프트 삭제 구조**:
  - `supplements` 테이블에 `deletedAt` 컬럼 추가
  - 하드 삭제 대신 타임스탬프로 삭제 상태 표시
  - `supplement_records` 테이블의 기록은 모두 유지
- **삭제 UX**:
  - 약/영양제 항목을 길게 누르면 삭제 가능
  - 삭제 확인 다이얼로그에서 "과거 기록 유지됨" 명시
  - 삭제된 항목은 "오늘 복용 체크" 목록에서 제거
- **캘린더/차트 표시**:
  - 삭제된 약/영양제는 연한 회색 배지 "삭제됨" 표시
  - 과거 복용 기록 조회 시 삭제 상태 명확히 표시
  - 데이터 연속성 유지로 차트 추이 그래프 정상 작동

---

## v0.1.0 (2025-12-26)

### 주요 기능 구현

#### SQLite 로컬 데이터베이스
- 모든 테이블 스키마 구현 (pets, daily_records, food_records 등)
- 서비스 레이어 구현:
  - `database.ts` - DB 초기화 및 테이블 생성
  - `dailyRecords.ts` - 일일 컨디션 기록
  - `foodRecords.ts` - 사료 기호성
  - `supplements.ts` - 약/영양제 복용 체크
  - `hospitalRecords.ts` - 병원 방문 기록
  - `fluidRecords.ts` - 수액 기록
  - `customMetrics.ts` - 커스텀 수치

#### 캘린더 화면 (신규)
- 월 단위 캘린더 UI
- 날짜별 기록 인디케이터 (●/🔴/💊/💧)
- 일자 요약 카드 (조회 전용)
- 무료 사용자 15일 제한
- 오늘만 수정 가능 (과거는 읽기 전용)

#### 탭 네비게이션 변경
```
변경 전: [ 홈 🏠 ] [ 기록 📝 ] [ 차트 📊 ] [ 설정 ⚙️ ]
변경 후: [ 오늘 📋 ] [ 캘린더 📅 ] [ 차트 📊 ] [ 설정 ⚙️ ]
```

---

### UI/UX 개선

#### 용어 표준화
| 변경 전 | 변경 후 |
|---------|---------|
| 오줌 | 소변 |
| 똥 | 배변 |
| 설사 | 묽은 변 |
| 구토 | 구토 (유지) |

#### 설정 화면 간소화
- 제거: 데이터 백업, 데이터 복원
- 유지: Pro 업그레이드, 앱 정보, 개인정보 처리방침, 이용약관, 데이터 초기화

---

### 기술 개선

#### React 버전 호환성
- npm overrides로 React 19.1.0 통일
- expo-sqlite 연동 안정화

#### Safe Area 처리
- SafeAreaProvider 적용
- 탭바 하단 inset 대응
- 각 화면 상단 safe area 처리

### 탭별 UX 재설계
- **오늘 탭**: 입력 전용 대시보드로 통합
  - 소변/배변/묽은 변/구토 카운터 (Undo 지원)
  - 수액 기록 (ml 입력, Undo 지원)
  - 약/영양제 체크박스
  - 메모 저장
  - **신규 기능**: 카운트 클릭 시 수치 직접 수정 (Modal), 입력 후 실행 취소(Undo) 토스트
- **캘린더 탭**: 조회 전용 (오늘 포함 수정 불가)
- **설정 탭**: PIN 설정, 백업/복원 추가

### 문서 추가
- `docs/planning/CALENDAR_SPEC.md` - 캘린더 화면 명세
- `docs/planning/TAB_UX_SPEC.md` - 탭별 UX 명세
- `docs/CHANGELOG.md` - 변경 로그

---

## 다음 단계 (예정)
- [ ] 백엔드 API 연동 (백업/복원)
- [ ] 인앱 결제 연동 (Pro)
- [ ] 앱스토어 배포 준비
