# Chart Agent Reference

## Chart Spec (CHART_SPEC.md)
# 📊 Chart & Analysis Specification (Integrated)

> **통합 문서 안내**
> 본 문서는 기존에 파편화되어 있던 아래 문서들을 통합 및 최신화한 것입니다.
> - `OVERALL_SUMMARY_SPEC.md`, `3M_CHART_SPEC.md`, `MEDICINE_CHART_SPEC.md`, `CHART_IMPROVEMENT_SPEC.md`
>
> **적용 대상**: `/charts/summary` (병원용 요약 차트) 및 `/charts/custom` 일부

---

## 1. 개요 및 설계 원칙

### 1.1 목적
반려묘의 건강 기록을 **기간별 목적에 맞게 시각화**하여, 보호자와 의료진이 직관적으로 상태를 파악할 수 있도록 한다.

### 1.2 핵심 원칙
1.  **기간에 따른 표현 변화**: 기간이 길어질수록 "상세 기록"에서 "패턴/요약"으로 표현 방식을 변경한다.
2.  **의료적 오해 방지**: 이벤트성 데이터(구토, 설사 등)를 연속 데이터(Line Chart)로 표현하지 않는다.
3.  **숫자 중심**: 그래프를 해석하지 않아도 정확한 수치를 읽을 수 있어야 한다.
4.  **스크롤 및 탐색**: 모바일 환경을 고려하여 적절한 스크롤 영역과 고정 영역을 분리한다.

---

## 2. 기간별 표현 전략 (Period Strategy)

| 기간 | 주요 목적 | 표현 방식 (밀도) |
| :-- | :-- | :-- |
| **15일 (15d)** | 상세 확인 | **일 단위 (Daily)** <br> - Dot Chart (증상) <br> - Bar Chart (수액) <br> - Timeline (약) |
| **1개월 (1m)** | 최근 추이 | **일 단위 (Daily)** <br> (15일과 동일, 표시 개수만 증가) |
| **3개월 (3m)** | 문제 구간 파악 | **주 단위 (Weekly Aggregation)** <br> - Bar Chart (주간 합계) <br> - Density Bar (약) |
| **전체 (All)** | 종합 평가 | **통계 카드 (Stats Only)** <br> - 차트 없음 <br> - 텍스트/숫자 기반 요약 리포트 |

---

## 3. 증상 차트 (Symptoms: 배변/설사/구토)

### 3.1 15일 / 1개월 (Daily View)
-   **차트 타입**: **Dot Chart** (점 차트)
-   **데이터 속성**: 이산 데이터 (Discrete). 0인 날은 표시하지 않음.
-   **표현 규칙**:
    -   X축: 날짜 (MM/DD)
    -   Y축: 횟수 (Counts)
    -   **수치 표시**: 점 바로 위에 숫자 고정 표시 (예: "3")
    -   **연결 금지**: 점과 점 사이를 선으로 연결하지 않음.

### 3.2 3개월 (Weekly View)
-   **차트 타입**: **Bar Chart** (막대 차트)
-   **데이터 속성**: 주간 합계 (Weekly Sum).
-   **표현 규칙**:
    -   X축: 주차 (W1 ~ W12)
    -   Y축: 주간 총 발생 횟수
    -   **수치 표시**: 막대 상단에 총 횟수 표시
    -   **해석**: "이 주에 유난히 증상이 잦았다"를 파악하는 용도.

### 3.3 전체 (Summary View)
-   **차트 없음**
-   **형태**: `증상 요약 카드`
-   **표시 항목**:
    -   구토: 누적 횟수
    -   설사: 발생 일수 (횟수 아님)
    -   평균 배변: (전체 배변 횟수 / 기록 일수)

---

## 4. 강수 / 수액 차트 (Fluids)

### 4.1 15일 / 1개월 (Daily View)
-   **차트 타입**: **Bar Chart** (독립 막대)
-   **데이터 속성**: 일별 총 투여량 (ml).
-   **표현 규칙**:
    -   타입 구분: 💧 강수 / 💉 수액 (색상/아이콘 구분)
    -   같은 날 다회 투여 시: 합산하여 하나의 막대로 표시.
    -   **수치 표시**: 막대 상단에 `N ml` 표시.

### 4.2 3개월 (Weekly View)
-   **차트 타입**: **Bar Chart** (주간 합계)
-   **데이터 속성**: 주간 총 투여량.
-   **해석**: 수액 투여 빈도와 강도가 높은 주간을 식별.

### 4.3 전체 (Summary View)
-   **차트 없음**
-   **형태**: `강수 / 수액 요약 카드`
-   **표시 항목**:
    -   총 강수량 (ml)
    -   총 수액량 (ml)
    -   전체 투여량 합계

---

## 5. 약 / 영양제 차트 (Medicines)

### 5.1 15일 / 1개월 (Daily Timeline)
> **목적**: 복용 성실도(Adherence) 및 연속성 확인

-   **구조**: 약물별 Row (가로 타임라인)
-   **표현 방식 (Adaptive)**:
    1.  **연속 복용(Continuous)**: 끊김 없는 기간 → **이어진 막대(Bar)** 로 표시.
    2.  **비연속 복용(Intermittent)**: 띄엄띄엄 복용 → **개별 점(Dot)** 로 표시.
-   **UX**:
    -   의료진이 "꾸준히 먹였는지" vs "가끔 먹였는지" 1초 만에 파악 가능해야 함.
    -   빈 날짜는 명확히 비워둠 (가짜 연결 금지).

### 5.2 3개월 (Weekly Density)
> **목적**: 장기 복용 패턴 및 밀도 확인

-   **구조**: 약물별 Row, 주 단위 블록
-   **표현 방식**:
    -   **Thick Bar**: 주 5회 이상 복용 (성실)
    -   **Thin Bar**: 주 2~4회 복용 (보통)
    -   **Dot**: 주 1회 이하 (미흡/간헐)
-   **해석**: 날짜별 상세보다는 "이 기간에 이 약을 열심히 먹였나"를 판단.

### 5.3 전체 (Summary Report)
> **목적**: 전체 복용 이력 요약

-   **형태**: 텍스트 리스트
-   **표시 항목**:
    -   복용 약물명
    -   기간: 시작일 ~ 종료일
    -   총 복용일 수
    -   평균 빈도 (예: "주 4.2회")

---

## 6. 전체 통계 (Summary All Period)

기간을 **'전체(All)'** 로 선택 시, 스크롤되는 차트 대신 **정적인 리포트 화면**을 제공한다.

### 6.1 구성 요소 (Stat Cards)
1.  **기록 기간 카드**
    -   최초 기록일 ~ 마지막 기록일
    -   총 기간 (일수)
2.  **증상 요약 카드** (3.3 참조)
3.  **강수/수액 요약 카드** (4.3 참조)
4.  **관리 밀도 카드**
    -   기록된 날짜 수 / 총 기간 = 기록률(%)
    -   "얼마나 꾸준히 관리했는가" 지표

---

## 7. 구현 가이드라인 (summary.tsx)

### 7.1 데이터 로딩
-   `Period` 변경 시 기존 데이터 `clear` 후 로딩 (깜빡임 허용, 데이터 혼동 방지).
-   `All` 모드일 경우: 전체 기간 `DailyRecords`를 가져와 클라이언트 사이드에서 집계(Aggregation) 수행. (DB 부하 고려 시 추후 쿼리 최적화 가능)

### 7.2 차트 렌더링 분기
```typescript
{period === 'all' ? (
  <OverallSummaryCards data={summaryData} />
) : period === '3m' ? (
  <WeeklyChartScrollView data={weeklyData} />
) : (
  <DailyChartScrollView data={dailyData} />
)}
```

### 7.3 공통 UI 규칙
-   **스크롤**: 데이터가 로드되면 자동으로 **가장 최신 날짜(우측 끝)** 로 스크롤 이동.
-   **숫자 가독성**: 폰트 사이즈 10~12px 유지, 배경 대비 명확한 색상 사용.
-   **빈 데이터 처리**:
    -   15d/1m/3m: "기록 없음" 텍스트 표시.
    -   All: 데이터가 하나도 없으면 "기록이 충분하지 않습니다" 안내.
