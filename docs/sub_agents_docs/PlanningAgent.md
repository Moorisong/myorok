# Planning Agent Reference

## AI Context (AI_CONTEXT.md)
# AI 컨텍스트 문서 (반려묘 병상일지 앱)

> AI(코딩 어시스턴트)가 **프로젝트 방향, 설계 원칙, MVP 범위**를 빠르게 이해하기 위한 요약 문서

---

## 1. 프로젝트 개요

### 서비스 목적
- 반려묘의 **일상·병상 기록을 장기 누적**
- 집사가 **병원 진료 시 바로 보여줄 수 있는 데이터** 제공
- 7일 무료 체험 후 **구독형 유료화**

### 핵심 가치
| 원칙 | 설명 |
|------|------|
| 기록은 자산이다 | 모든 데이터는 영구 보존 |
| 삭제하지 않는다 | 데이터 삭제 기능 없음 |
| 기능 차별 없음 | 체험/구독 상태와 관계없이 동일 기능 제공 |

---

## 2. 플랫폼 & 기술 스택

| 구분 | 기술 | 비고 |
|------|------|------|
| 모바일 앱 | React Native + Expo (Managed) | Android 전용 |
| 웹 | Next.js (App Router) | 소개/신뢰/정책 페이지 |
| 데이터 저장 | SQLite (expo-sqlite) | 로컬 저장, 텍스트/숫자 위주 |
| 서버 | 없음 | MVP 단계 |
| 로그인 | 없음 | 디바이스 단위 |
| 사진/영상 | 없음 | MVP 제외 |

---

## 3. 데이터 정책 ⚠️ 중요

### 핵심 원칙
```
- 자동 삭제 없음
- 수년 누적 전제
- 데이터는 항상 저장되어 있으며, 삭제하지 않는다
```

### 구독 정책
| 구분 | 기간 | 기능 |
|------|------|------|
| 무료 체험 | 7일 | 모든 기능 사용 가능 |
| 구독 | 월 3,500원 | 모든 기능 사용 가능 |
| 미구독 | - | 앱 사용 불가 (결제 화면만 접근) |

> 체험/구독 상태와 관계없이 **기능 차별 없음**. 미구독 시에도 데이터는 보존됨.

---

## 3.1 날짜 기준 데이터 규칙 ⚠️ 중요

> 모든 기록은 **하루 1 row** 기준

| 데이터 타입 | 같은 날 처리 |
|------------|-------------|
| 배변/구토 | 누적 카운트 (+1) |
| 수치 데이터 | 덮어쓰기 또는 수정 |

```
⚠️ 이 규칙 미정의 시 차트 구현 복잡도 급증
```

---

## 3.2 다묘 지원 구조 ✅

> 다묘(여러 고양이) 지원 완료

| 항목 | 설계 |
|------|------|
| 내부 구조 | `petId` 항상 포함 |
| UI | 상단 고양이 선택 드롭다운 |
| 데이터 관리 | petId별 필터링 |
| 삭제 정책 | 소프트 삭제 (`deletedAt`) |
| 백업 | petId 포함 전체 JSON |

📌 자세한 내용: [다묘 확장 기획](./MULTI_PET_SPEC.md)

---

## 4. 주요 기록 도메인

### 4.1 기본 컨디션 (일일 누적)
| 항목 | 입력 방식 | 비고 |
|------|----------|------|
| 오줌 횟수 | +1 버튼 | 확인 시마다 누적 |
| 똥 횟수 | +1 버튼 | 설사 여부 별도 카운트 |
| 구토 횟수 | +1 버튼 | 색상 라벨: 투명/흰색/사료토 등 |
| 특이사항 | 메모 | 자유 입력 |

> **UX**: 하루 한 번 입력 ❌ → 확인 시마다 누적 입력 ✅

---

### 4.2 사료 기호성
| 항목 | 값 |
|------|-----|
| 사료 타입 | 건사료 / 캔 / 기타 |
| 기호성 | 잘먹음 / 보통 / 거부 |
| 코멘트 | 자유 메모 |

---

### 4.3 약 / 영양제
- 유저가 직접 이름 입력 → 라벨 생성
- 복용 여부 체크
- 개수 제한 없음
- 약 / 영양제 동일 구조

---

### 4.4 병원 기록
- 병원 방문 메모
- 진단/처방 요약
- 자유 메모 영역

---

### 4.5 주기적 수치 기록 (그래프용)
| 항목 | 비고 |
|------|------|
| 체중 | 수치형 데이터 |
| 음수량 | ❌ 기록 안 함 (자발적 음수) |
| 표시 | 날짜 기준 추이 그래프 |

---

### 4.6 병원용 차트
**목적**: 증상 변화 + 약 복용 기간을 한 화면에 표시

```
X축: 날짜
Y축: 증상 수치 / 횟수
오버레이: 약 복용 기간 Bar
```

---

### 4.7 사용자 커스텀 수치 차트
- 혈액검사 등 유저가 수치명 직접 입력
- 값 입력 → 추이 그래프
- 다중 차트 가능

---

### 4.8 수액 및 강수 기록
| 항목 | 비고 |
|------|------|
| 날짜 | 필수 |
| 수액 종류 | 피하 / 정맥 / 강수(강제 급수) |
| 용량 | ml 단위 (회차별 기록) |
| 반응/메모 | 자유 입력 |

> **구현**: `fluid_records` 테이블에 `fluidType`으로 구분하여 저장. (List 형태 UX)

---

## 5. 결제 정책

| 항목 | 값 |
|------|-----|
| 결제 방식 | Google Play In-App Purchase |
| 상태 저장 | `isPro` boolean 로컬 저장 |
| 서버 검증 | 없음 (MVP 단계) |

---

## 6. 설계 원칙 요약

| 원칙 | 설명 |
|------|------|
| 서버 도입 시점 | 필요해질 때 |
| 우선순위 | 기록 구조 > UX |
| 데이터 정책 | 삭제 대신 접근 제한 |
| 사용자 중심 | 집사 실사용 흐름 최우선 |
| 최종 목표 | 병원에 보여줄 수 있어야 함 |

---

## 7. 개발 규칙

> [!IMPORTANT]
> 아래 규칙을 반드시 준수할 것

| 규칙 | 설명 |
|------|------|
| **Android 전용** | iOS 관련 코드 작성 금지 (`Platform.OS === 'ios'`, `ActionSheetIOS` 등) |
| **CHANGELOG 금지** | CHANGELOG.md 파일 생성/유지 금지, git 커밋 메시지로 대체 |

---
## Pricing (PRICING.md)
# 구독 정책 및 가격 정책 정리 (최종안)

## 요약
- **7일 무료 체험 후 유료 전환**
- **월 구독료: 3,500원**
- **미구독 시 앱 사용 불가**
- **기능 차별 없음 (무료/유료 기능 동일)**
- **광고 없음**
- **데이터는 항상 안전하게 보관**

---

## 가격 정책

- 월 구독료: **3,500원**
- 첫 설치 시 **7일 무료 체험 제공**
- 체험 기간 중 언제든 해지 가능
- 체험 종료 후 구독하지 않으면 앱 이용 차단

---

## 무료 체험 정책 (7일)

### 제공 범위
- 유료 사용자와 **동일한 기능 100% 제공**
- 모든 기록/차트/쉼터/설정 기능 사용 가능

### UX 원칙
- 체험 시작 시 명확한 고지  
  > "7일 무료 체험 후 구독이 필요합니다."
- 설정 탭 및 홈 상단에 **남은 체험 기간 표시**
  - 예: `무료 체험 D-3`

---

## 체험 종료 후 (미구독 상태)

### 앱 접근 상태
- 앱 실행 시 **전면 구독 유도 화면 표시**
- 아래 기능 모두 사용 불가:
  - 기록 조회 ❌
  - 기록 작성 ❌
  - 쉼터 ❌
  - 차트 ❌

### 허용되는 영역
- 구독 결제 화면
- 고객 문의 / 앱 정보

### 데이터 정책
- 사용자가 작성한 모든 데이터는 **삭제되지 않음**
- 구독 재개 시 즉시 전체 데이터 복구 및 접근 가능

> 안내 문구 예시  
> "기록한 데이터는 안전하게 보관 중이에요.  
> 구독하면 바로 다시 확인할 수 있어요."

---

## 유료 구독 상태

- 모든 기능 무제한 사용
- 기간 제한 없음
- 데이터 제한 없음
- 광고 없음

---

## 핵심 원칙

1. **기능 차별 없음**
   - 무료/유료의 차이는 "기간"과 "접근 가능 여부"뿐
2. **애매한 제한 없음**
   - 미구독 상태에서는 명확하게 사용 차단
3. **정직한 구조**
   - 써보고 결정 → 마음에 들면 결제
4. **데이터 신뢰**
   - 결제 여부와 관계없이 데이터는 항상 보존

---

## 전환을 위한 필수 장치

- 체험 종료 24시간 전 푸시 알림
  > "무료 체험이 곧 종료돼요. 계속 사용하려면 구독이 필요해요."
- 체험 종료 당일 전면 구독 화면 노출
- 가격 인식 문구:
  > "하루 100원도 안 되는 반려동물 기록"

---

## 결론

이 앱은 **부분 무료 앱이 아니라 체험형 구독 앱**이다.  
7일 동안 충분히 써보고,  
**쓸 가치가 있다고 느낀 사용자만 남긴다.**

---
## Multi Pet Spec (MULTI_PET_SPEC.md)
# 🐾 반려묘 병상일지 앱 – 다묘(여러 고양이) 확장 기획

---

## 1. 목적

- 집사가 여러 마리 고양이를 각각 관리할 수 있도록 함
- 기록, 차트, 캘린더 모두 **묘별 필터** 가능
- 다묘 지원 완료 (petId 기준 관리)

---

## 2. 구조 변경

| 항목 | 기존 | 변경 |
|------|------|------|
| pets 테이블 | 1 row | 여러 row 가능, `id` 기준 |
| daily_records 등 | petId 필드 존재 | 그대로 유지, petId 기준 필터 |
| UI | 단일 오늘 탭/캘린더/차트 | 묘 선택 UI 추가 (예: 상단 드롭다운/탭) |

---

## 3. UX 설계

### 3.1 앱 진입

- 앱 최초 실행 시 **고양이 선택 화면**
  - 1마리: 바로 오늘 탭
  - 2마리 이상: 리스트 선택
- 설정에서 **고양이 추가/삭제/편집 가능**

### 3.2 오늘 탭

- 상단에 **고양이 드롭다운**
- 선택한 고양이 기준으로 입력
- 누적 카운트, Undo, 수치 수정 등 기존 UX 유지

### 3.3 캘린더/차트 탭

- 고양이 선택 필터 유지
- 고양이별 기록 조회 가능
- 고양이별 기록 조회 가능

### 3.4 기록 추가/편집

- pets 테이블에 새 row 추가
- 각 기록 테이블 `petId` 연결
- 기존 데이터와 혼동 없이 관리 가능

---

## 4. 데이터 정책

- 기존 정책 그대로 유지
- 삭제하지 않음
- SQLite 구조: 기존 테이블 그대로, petId 필터 추가

---

## 5. UI 예시

```
[오늘 탭 상단]
고양이 선택 ▼ [냥이A] [냥이B]

[캘린더 상단]
고양이 선택 ▼ [냥이A] [냥이B]

[차트 상단]
고양이 선택 ▼ [냥이A] [냥이B]
```

- 선택 시 즉시 화면 데이터 갱신
- 과거 데이터는 petId 기준 조회

---

## 6. 확장 장점

- 다묘 지원 준비 완료
- 향후 Pro 포인트, 맞춤 알림, 다묘 통계 등 기능 확장 가능
- 백업/복원: deviceId 기준 → petId 포함 JSON 그대로 저장 가능

---

## 7. 구현 요약

### 7.1 UI

- 고양이 선택 드롭다운 / 탭
- 설정에서 고양이 추가/삭제/편집

### 7.2 DB

- 기존 테이블 유지, `petId` 필터 추가

### 7.3 기능

- 오늘/캘린더/차트 모두 petId 기준 조회

### 7.4 백업/복원

- petId 포함 JSON으로 전체 백업

---

## 8. 고양이 관리 화면

### 8.1 고양이 추가

| 항목 | 설명 |
|------|------|
| 이름 | 필수 입력 |
| 생성일 | 자동 기록 |
| ID | UUID 자동 생성 |

### 8.2 고양이 편집

- 이름 수정 가능
- ID, 생성일은 수정 불가

### 8.3 고양이 삭제

- ⚠️ **소프트 삭제** (데이터 정책 준수)
- `deletedAt` 필드 추가
- 삭제된 고양이의 기록은 유지되지만 UI에서 숨김
- 복원 기능 제공 (삭제 후 일정 기간 내)

---

## 9. 기술 구현 포인트

### 9.1 상태 관리

- 현재 선택된 고양이 ID를 전역 상태로 관리
- AsyncStorage에 저장하여 앱 재시작 시에도 유지

### 9.2 데이터 조회

```typescript
// 모든 기록 조회 시 petId 필터 적용
const records = await db.getAllAsync(
  'SELECT * FROM daily_records WHERE petId = ? AND date = ?',
  [selectedPetId, date]
);
```

### 9.3 고양이 선택 UI 컴포넌트

- `PetSelector.tsx` - 드롭다운 형태
- 상단 고정 위치
- 선택 시 전역 상태 업데이트 → 화면 데이터 자동 갱신

---

## 요약

```
✅ 다묘 지원 구조 완성
✅ UI 최소 침투 (상단 선택기만 추가)
✅ 기존 데이터 정책 유지
✅ 확장 가능한 설계
```
