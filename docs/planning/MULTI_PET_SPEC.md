# 🐾 반려묘 병상일지 앱 – 다묘(여러 고양이) 확장 기획

---

## 1. 목적

- 집사가 여러 마리 고양이를 각각 관리할 수 있도록 함
- 기록, 차트, 캘린더 모두 **묘별 필터** 가능
- 프로/무료 접근 제한도 묘별 적용 가능

---

## 2. 구조 변경

| 항목 | 기존 | 변경 |
|------|------|------|
| pets 테이블 | 1 row | 여러 row 가능, `id` 기준 |
| daily_records 등 | petId 필드 존재 | 그대로 유지, petId 기준 필터 |
| UI | 단일 오늘 탭/캘린더/차트 | 묘 선택 UI 추가 (예: 상단 드롭다운/탭) |

---

## 3. UX 설계

### 3.1 앱 진입

- 앱 최초 실행 시 **고양이 선택 화면**
  - 1마리: 바로 오늘 탭
  - 2마리 이상: 리스트 선택
- 설정에서 **고양이 추가/삭제/편집 가능**

### 3.2 오늘 탭

- 상단에 **고양이 드롭다운**
- 선택한 고양이 기준으로 입력
- 누적 카운트, Undo, 수치 수정 등 기존 UX 유지

### 3.3 캘린더/차트 탭

- 고양이 선택 필터 유지
- 고양이별 기록 조회 가능
- 무료/유료 제한도 각 고양이별 적용

### 3.4 기록 추가/편집

- pets 테이블에 새 row 추가
- 각 기록 테이블 `petId` 연결
- 기존 데이터와 혼동 없이 관리 가능

---

## 4. 데이터 정책

- 기존 정책 그대로 유지
- 삭제하지 않음
- 무료/유료 접근은 **묘별 기준** 적용
- SQLite 구조: 기존 테이블 그대로, petId 필터 추가

---

## 5. UI 예시

```
[오늘 탭 상단]
고양이 선택 ▼ [냥이A] [냥이B]

[캘린더 상단]
고양이 선택 ▼ [냥이A] [냥이B]

[차트 상단]
고양이 선택 ▼ [냥이A] [냥이B]
```

- 선택 시 즉시 화면 데이터 갱신
- 과거 데이터는 petId 기준 조회

---

## 6. 확장 장점

- 다묘 지원 준비 완료
- 향후 Pro 포인트, 맞춤 알림, 다묘 통계 등 기능 확장 가능
- 백업/복원: deviceId 기준 → petId 포함 JSON 그대로 저장 가능

---

## 7. 구현 요약

### 7.1 UI

- 고양이 선택 드롭다운 / 탭
- 설정에서 고양이 추가/삭제/편집

### 7.2 DB

- 기존 테이블 유지, `petId` 필터 추가

### 7.3 기능

- 오늘/캘린더/차트 모두 petId 기준 조회
- 무료/유료 제한도 묘별 적용

### 7.4 백업/복원

- petId 포함 JSON으로 전체 백업

---

## 8. 고양이 관리 화면

### 8.1 고양이 추가

| 항목 | 설명 |
|------|------|
| 이름 | 필수 입력 |
| 생성일 | 자동 기록 |
| ID | UUID 자동 생성 |

### 8.2 고양이 편집

- 이름 수정 가능
- ID, 생성일은 수정 불가

### 8.3 고양이 삭제

- ⚠️ **소프트 삭제** (데이터 정책 준수)
- `deletedAt` 필드 추가
- 삭제된 고양이의 기록은 유지되지만 UI에서 숨김
- 복원 기능 제공 (삭제 후 일정 기간 내)

---

## 9. 기술 구현 포인트

### 9.1 상태 관리

- 현재 선택된 고양이 ID를 전역 상태로 관리
- AsyncStorage에 저장하여 앱 재시작 시에도 유지

### 9.2 데이터 조회

```typescript
// 모든 기록 조회 시 petId 필터 적용
const records = await db.getAllAsync(
  'SELECT * FROM daily_records WHERE petId = ? AND date = ?',
  [selectedPetId, date]
);
```

### 9.3 고양이 선택 UI 컴포넌트

- `PetSelector.tsx` - 드롭다운 형태
- 상단 고정 위치
- 선택 시 전역 상태 업데이트 → 화면 데이터 자동 갱신

---

## 요약

```
✅ 다묘 지원 구조 완성
✅ UI 최소 침투 (상단 선택기만 추가)
✅ 기존 데이터 정책 유지
✅ 확장 가능한 설계
```
